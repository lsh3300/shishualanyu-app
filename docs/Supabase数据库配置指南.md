# 世说蓝语应用数据库配置指南

本指南将帮助您在Supabase中配置数据库表结构和行级安全(RLS)策略。

## 前提条件

1. 已创建Supabase项目
2. 已在.env.local文件中配置Supabase URL和API密钥
3. 已安装@supabase/supabase-js客户端库

## 配置步骤

### 1. 执行数据库表结构脚本

1. 登录到您的Supabase控制台
2. 转到"SQL编辑器"页面
3. 点击"新查询"
4. 复制并粘贴`supabase/schemas.sql`文件的内容
5. 点击"运行"执行脚本

此脚本将创建以下表：
- `profiles` - 用户配置文件
- `products` - 产品信息
- `orders` - 订单信息
- `order_items` - 订单项详情
- `courses` - 课程信息
- `enrollments` - 课程注册
- `favorites` - 产品收藏
- `addresses` - 用户地址
- `messages` - 消息
- `notifications` - 通知

### 2. 配置行级安全(RLS)策略

1. 在Supabase控制台中，继续在"SQL编辑器"页面
2. 点击"新查询"
3. 复制并粘贴`supabase/policies.sql`文件的内容
4. 点击"运行"执行脚本

此脚本将：
- 启用所有表的行级安全
- 为每个表创建适当的访问策略
- 确保用户只能访问自己的数据

### 3. 插入示例数据（可选）

1. 在Supabase控制台中，继续在"SQL编辑器"页面
2. 点击"新查询"
3. 复制并粘贴`supabase/seed.sql`文件的内容
4. 点击"运行"执行脚本

此脚本将插入示例产品和课程数据，方便您测试应用。

## 验证配置

1. 在Supabase控制台中，转到"表编辑器"页面
2. 确认所有表已创建
3. 转到"认证" > "策略"页面
4. 确认所有策略已正确创建

## 常见问题

### Q: 执行脚本时出现错误怎么办？
A: 请检查脚本是否按顺序执行。确保先执行`schemas.sql`，再执行`policies.sql`，最后执行`seed.sql`。

### Q: 如何修改表结构？
A: 您可以在Supabase控制台的"表编辑器"中直接修改表结构，或编写新的SQL脚本执行。

### Q: 如何添加新的RLS策略？
A: 您可以在"认证" > "策略"页面中添加新策略，或编写SQL脚本执行。

## 安全注意事项

1. 确保所有表都启用了RLS
2. 定期检查和更新安全策略
3. 不要在前端暴露服务端密钥
4. 使用环境变量存储敏感信息

## 后续步骤

完成数据库配置后，您可以：
1. 实现身份验证功能
2. 创建数据操作示例
3. 配置生产环境部署

如有任何问题，请参考Supabase官方文档或联系技术支持。