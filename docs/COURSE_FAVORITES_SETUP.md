# è¯¾ç¨‹æ”¶è—åŠŸèƒ½å®Œæ•´è®¾ç½®æŒ‡å—

## æ¦‚è¿°
æœ¬æŒ‡å—å°†å¸®åŠ©ä½ å®Œæ•´é…ç½®è¯¾ç¨‹æ”¶è—åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ•°æ®åº“è¡¨åˆ›å»ºã€æ•°æ®åˆå§‹åŒ–å’ŒåŠŸèƒ½æµ‹è¯•ã€‚

## åŠŸèƒ½ç‰¹æ€§
- âœ… æ”¯æŒå•†å“æ”¶è—
- âœ… æ”¯æŒè¯¾ç¨‹æ”¶è—
- âœ… ç»Ÿä¸€çš„æ”¶è— API
- âœ… æ”¶è—åˆ—è¡¨é¡µé¢æ˜¾ç¤ºå•†å“å’Œè¯¾ç¨‹
- âœ… è¯¾ç¨‹è¯¦æƒ…é¡µæ”¶è—æŒ‰é’®
- âœ… è¯¾ç¨‹å¡ç‰‡æ”¶è—æŒ‰é’®

## æ•°æ®åº“ç»“æ„

### æ–°å¢è¡¨
1. **courses** - è¯¾ç¨‹è¡¨
   - å­˜å‚¨è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯ï¼ˆæ ‡é¢˜ã€æè¿°ã€è®²å¸ˆã€ä»·æ ¼ç­‰ï¼‰
   - æ”¯æŒé€šè¿‡ UUID æˆ– slug æŸ¥è¯¢

2. **course_chapters** - è¯¾ç¨‹ç« èŠ‚è¡¨
   - å…³è”åˆ° courses è¡¨
   - å­˜å‚¨ç« èŠ‚æ ‡é¢˜ã€æ—¶é•¿ã€æ˜¯å¦å…è´¹ç­‰ä¿¡æ¯

3. **favorites** è¡¨æ›´æ–°
   - æ–°å¢ `course_id` å­—æ®µ
   - æ·»åŠ çº¦æŸç¡®ä¿ `product_id` å’Œ `course_id` äº’æ–¥

## åˆå§‹åŒ–æ­¥éª¤

### æ–¹æ³•ä¸€ï¼šæ‰‹åŠ¨æ‰§è¡Œï¼ˆæ¨èç”¨äºé¦–æ¬¡è®¾ç½®ï¼‰

#### æ­¥éª¤ 1ï¼šåˆ›å»ºæ•°æ®åº“è¡¨

1. æ‰“å¼€ Supabase Dashboard
   - è®¿é—® https://supabase.com/dashboard
   - é€‰æ‹©ä½ çš„é¡¹ç›®

2. è¿›å…¥ SQL Editor
   - ç‚¹å‡»å·¦ä¾§èœå•çš„ "SQL Editor"
   - ç‚¹å‡» "New Query"

3. æ‰§è¡Œ SQL è„šæœ¬
   ```bash
   # å¤åˆ¶ä»¥ä¸‹æ–‡ä»¶çš„å†…å®¹åˆ°æŸ¥è¯¢ç¼–è¾‘å™¨
   scripts/init-courses-table.sql
   ```
   - ç‚¹å‡» "Run" æŒ‰é’®æ‰§è¡Œ

#### æ­¥éª¤ 2ï¼šåˆå§‹åŒ–äº§å“æ•°æ®

```bash
node scripts/seed-products.js
```

#### æ­¥éª¤ 3ï¼šåˆå§‹åŒ–è¯¾ç¨‹æ•°æ®

```bash
node scripts/seed-courses.js
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨ä¸€é”®è„šæœ¬

```bash
node scripts/init-all.js
```

è¯¥è„šæœ¬ä¼šï¼š
1. æç¤ºä½ å…ˆåœ¨ Supabase Dashboard æ‰§è¡Œ SQL
2. ç­‰å¾…ä½ å®Œæˆåç»§ç»­
3. è‡ªåŠ¨æ‰§è¡Œäº§å“å’Œè¯¾ç¨‹æ•°æ®åˆå§‹åŒ–

## API ç«¯ç‚¹

### è¯¾ç¨‹ API

#### è·å–è¯¾ç¨‹åˆ—è¡¨
```http
GET /api/courses?category=æ‰æŸ“&difficulty=å…¥é—¨&is_free=true&limit=20&offset=0
```

å“åº”ï¼š
```json
{
  "courses": [...],
  "total": 8,
  "limit": 20,
  "offset": 0
}
```

#### è·å–å•ä¸ªè¯¾ç¨‹
```http
GET /api/courses/[id]
```

æ”¯æŒé€šè¿‡ UUID æˆ– slug æŸ¥è¯¢ï¼š
- `/api/courses/c0000001-0001-0001-0001-000000000001`
- `/api/courses/tie-dye-basics`

å“åº”ï¼š
```json
{
  "id": "c0000001-0001-0001-0001-000000000001",
  "slug": "tie-dye-basics",
  "title": "ä¼ ç»Ÿæ‰æŸ“åŸºç¡€å…¥é—¨è¯¾ç¨‹",
  "chapters": [...]
}
```

### æ”¶è— API

#### è·å–æ”¶è—åˆ—è¡¨
```http
GET /api/user/favorites
Headers: Authorization: Bearer {token}
```

å“åº”ï¼š
```json
{
  "favorites": [
    {
      "id": "...",
      "product_id": "...",
      "item_type": "product",
      "products": {...}
    },
    {
      "id": "...",
      "course_id": "...",
      "item_type": "course",
      "courses": {...}
    }
  ]
}
```

#### æ·»åŠ å•†å“æ”¶è—
```http
POST /api/user/favorites
Headers: Authorization: Bearer {token}
Body: { "productId": "11111111-..." }
```

#### æ·»åŠ è¯¾ç¨‹æ”¶è—
```http
POST /api/user/favorites
Headers: Authorization: Bearer {token}
Body: { "courseId": "c0000001-..." }
```

#### åˆ é™¤æ”¶è—
```http
DELETE /api/user/favorites
Headers: Authorization: Bearer {token}
Body: { "productId": "..." } æˆ– { "courseId": "..." }
```

## æµ‹è¯•æ­¥éª¤

### 1. æµ‹è¯•è¯¾ç¨‹æ”¶è—

1. é‡å¯å¼€å‘æœåŠ¡å™¨
   ```bash
   npm run dev
   ```

2. è®¿é—®è¯¾ç¨‹é¡µé¢ï¼ˆå¦‚ `/teaching`ï¼‰

3. é¼ æ ‡æ‚¬åœåœ¨è¯¾ç¨‹å¡ç‰‡ä¸Šï¼Œåº”è¯¥çœ‹åˆ°æ”¶è—æŒ‰é’®

4. ç‚¹å‡»æ”¶è—æŒ‰é’®
   - åº”è¯¥æ˜¾ç¤º"æ”¶è—æˆåŠŸ"æç¤º
   - æŒ‰é’®åº”è¯¥å˜ä¸ºçº¢è‰²å¡«å……çš„å¿ƒå½¢

5. è®¿é—®æ”¶è—é¡µé¢ `/profile/favorites`
   - åˆ‡æ¢åˆ°"è¯¾ç¨‹æ”¶è—"æ ‡ç­¾
   - åº”è¯¥çœ‹åˆ°åˆšæ‰æ”¶è—çš„è¯¾ç¨‹

### 2. æµ‹è¯•å•†å“æ”¶è—

1. è®¿é—®å•†åº—é¡µé¢ `/store`

2. ç‚¹å‡»å•†å“å¡ç‰‡ä¸Šçš„å¿ƒå½¢å›¾æ ‡

3. è®¿é—® `/profile/favorites`
   - "å•†å“æ”¶è—"æ ‡ç­¾åº”æ˜¾ç¤ºæ”¶è—çš„å•†å“
   - å•†å“åº”è¯¥æœ‰å›¾ç‰‡æ˜¾ç¤º

### 3. æµ‹è¯•å–æ¶ˆæ”¶è—

1. åœ¨æ”¶è—é¡µé¢æˆ–è¯¾ç¨‹/å•†å“é¡µé¢
2. å†æ¬¡ç‚¹å‡»å·²æ”¶è—çš„é¡¹ç›®
3. åº”è¯¥æ˜¾ç¤º"å–æ¶ˆæ”¶è—æˆåŠŸ"

## ç§å­æ•°æ®

### äº§å“æ•°æ®ï¼ˆ5ä¸ªï¼‰
- æ‰æŸ“Tæ¤
- èœ¡æŸ“ä¸å·¾
- æ‰æŸ“å¸†å¸ƒåŒ…
- èœ¡æŸ“æŠ±æ•
- æ‰æŸ“å£æŒ‚

### è¯¾ç¨‹æ•°æ®ï¼ˆ8ä¸ªï¼‰
1. ä¼ ç»Ÿæ‰æŸ“åŸºç¡€å…¥é—¨è¯¾ç¨‹ï¼ˆå…è´¹ï¼‰
2. æ‰æŸ“è¿›é˜¶æŠ€æ³•ä¸åˆ›ä½œï¼ˆÂ¥168ï¼‰
3. ç°ä»£æ‰æŸ“è‰ºæœ¯åˆ›ä½œï¼ˆÂ¥198ï¼‰
4. æ‰æŸ“å·¥è‰ºä¸å•†ä¸šåº”ç”¨ï¼ˆÂ¥128ï¼‰
5. èœ¡æŸ“å·¥è‰ºåŸºç¡€å…¥é—¨ï¼ˆÂ¥199ï¼‰
6. ä¼ ç»Ÿè‹—æ—èœ¡æŸ“æŠ€æ³•ï¼ˆÂ¥258ï¼‰
7. èœ¡æŸ“çº¹æ ·è®¾è®¡ä¸åº”ç”¨ï¼ˆÂ¥178ï¼‰
8. èœ¡æŸ“ä¸æ‰æŸ“ç»“åˆåˆ›ä½œï¼ˆÂ¥238ï¼‰

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šè¯¾ç¨‹æ”¶è—æŒ‰é’®ç‚¹å‡»æ— ååº”

**æ£€æŸ¥ï¼š**
1. æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
2. ç½‘ç»œè¯·æ±‚æ˜¯å¦æˆåŠŸï¼ˆF12 â†’ Network æ ‡ç­¾ï¼‰
3. æ˜¯å¦å·²ç™»å½•

**è§£å†³ï¼š**
```bash
# æŸ¥çœ‹ç»ˆç«¯æ—¥å¿—ï¼Œç¡®è®¤ API è°ƒç”¨
# åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š
# POST /api/user/favorites
# ğŸ“š å¤„ç†åçš„è¯¾ç¨‹æ•°æ®: [...]
```

### é—®é¢˜ 2ï¼šæ•°æ®åº“çº¦æŸé”™è¯¯

**é”™è¯¯ä¿¡æ¯ï¼š**
```
foreign key constraint "favorites_course_id_fkey"
```

**è§£å†³ï¼š**
1. ç¡®è®¤å·²æ‰§è¡Œ `init-courses-table.sql`
2. ç¡®è®¤ courses è¡¨å·²åˆ›å»º
3. ç¡®è®¤è¯¾ç¨‹æ•°æ®å·²åˆå§‹åŒ–

### é—®é¢˜ 3ï¼šæ”¶è—åˆ—è¡¨æ˜¾ç¤ºä¸æ­£ç¡®

**æ£€æŸ¥ï¼š**
1. API è¿”å›çš„æ•°æ®ç»“æ„
2. `use-favorites` hook çš„æ•°æ®å¤„ç†é€»è¾‘

**è°ƒè¯•ï¼š**
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹
console.log('Favorites:', favorites)
console.log('Favorite Products:', favoriteProducts)
console.log('Favorite Courses:', favoriteCourses)
```

## æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
```
scripts/
â”œâ”€â”€ init-courses-table.sql    # æ•°æ®åº“è¡¨åˆ›å»ºè„šæœ¬
â”œâ”€â”€ seed-courses.js            # è¯¾ç¨‹æ•°æ®ç§å­è„šæœ¬
â””â”€â”€ init-all.js                # ä¸€é”®åˆå§‹åŒ–è„šæœ¬

data/
â””â”€â”€ courses-seed.json          # è¯¾ç¨‹ç§å­æ•°æ®

app/api/
â”œâ”€â”€ courses/
â”‚   â”œâ”€â”€ route.ts              # è¯¾ç¨‹åˆ—è¡¨ API
â”‚   â””â”€â”€ [id]/route.ts         # å•ä¸ªè¯¾ç¨‹ API
```

### ä¿®æ”¹çš„æ–‡ä»¶
```
app/api/user/favorites/route.ts    # æ”¯æŒè¯¾ç¨‹æ”¶è—
hooks/use-favorites.ts              # é‡æ–°å¯ç”¨è¯¾ç¨‹æ”¶è—
components/ui/course-card.tsx       # é‡æ–°å¯ç”¨æ”¶è—æŒ‰é’®
```

## ä¸‹ä¸€æ­¥

é…ç½®å®Œæˆåï¼Œä½ å¯ä»¥ï¼š
1. è‡ªå®šä¹‰è¯¾ç¨‹æ•°æ®ï¼ˆç¼–è¾‘ `data/courses-seed.json`ï¼‰
2. æ·»åŠ æ›´å¤šè¯¾ç¨‹åˆ†ç±»
3. å®ç°è¯¾ç¨‹è¯¦æƒ…é¡µ
4. æ·»åŠ è¯¾ç¨‹å­¦ä¹ è¿›åº¦è¿½è¸ª
5. å®ç°è¯¾ç¨‹è¯„è®ºåŠŸèƒ½

## éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. Supabase Dashboard ä¸­è¡¨æ˜¯å¦æ­£ç¡®åˆ›å»º
2. ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®é…ç½®ï¼ˆ`.env.local`ï¼‰
3. å¼€å‘æœåŠ¡å™¨ç»ˆç«¯æ—¥å¿—
4. æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
