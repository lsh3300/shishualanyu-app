# è´­ç‰©è½¦åŠŸèƒ½ä¿®å¤æ€»ç»“

## ğŸ› é—®é¢˜è¯Šæ–­

### åŸå§‹é”™è¯¯
```
âŒ äº§å“æŸ¥è¯¢é”™è¯¯: {
  code: '42703',
  message: 'column products.in_stock does not exist'
}
```

**æ ¹æœ¬åŸå› ï¼š** `/api/cart` è·¯ç”±åœ¨æŸ¥è¯¢äº§å“æ—¶ä½¿ç”¨äº† `in_stock` å­—æ®µï¼Œä½† `products` è¡¨ä¸­æ²¡æœ‰æ­¤å­—æ®µã€‚

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. ä¿®å¤è´­ç‰©è½¦ API (`/app/api/cart/route.ts`)

**ä¿®æ”¹å‰ï¼š**
```typescript
const { data: product, error: productError } = await supabase
  .from('products')
  .select('id, name, price, in_stock')  // âŒ in_stock ä¸å­˜åœ¨
  .eq('id', product_id)
  .single()

if (product.in_stock === false) {
  return NextResponse.json({ error: 'è¯¥å•†å“å·²å”®ç½„' }, { status: 400 });
}
```

**ä¿®æ”¹åï¼š**
```typescript
const { data: product, error: productError } = await supabase
  .from('products')
  .select('id, name, price, stock_quantity')  // âœ… ä½¿ç”¨ stock_quantity
  .eq('id', product_id)
  .single()

// æ£€æŸ¥åº“å­˜ï¼ˆå¦‚æœå­—æ®µå­˜åœ¨ä¸”ä¸º 0 æˆ–æ›´å°‘ï¼‰
if (product.stock_quantity !== undefined && product.stock_quantity <= 0) {
  return NextResponse.json({ error: 'è¯¥å•†å“å·²å”®ç½„' }, { status: 400 });
}
```

### 2. åˆ›å»ºè°ƒè¯•å·¥å…·

åˆ›å»ºäº† `/api/debug/check-products-schema` ä»¥ä¾¿æŸ¥çœ‹äº§å“è¡¨çš„å®é™…å­—æ®µç»“æ„ã€‚

## ğŸ“‹ Products è¡¨å­—æ®µè¯´æ˜

æ ¹æ®ä»£ç æ¨æ–­ï¼Œ`products` è¡¨åº”è¯¥åŒ…å«ä»¥ä¸‹å­—æ®µï¼š
- `id` (UUID) - ä¸»é”®
- `slug` (TEXT) - URL å‹å¥½æ ‡è¯†ç¬¦
- `name` (TEXT) - äº§å“åç§°
- `description` (TEXT) - äº§å“æè¿°
- `price` (DECIMAL) - ä»·æ ¼
- `original_price` (DECIMAL) - åŸä»·
- `category` (TEXT) - åˆ†ç±»
- `inventory` (INTEGER) - åº“å­˜æ•°é‡
- `stock_quantity` (INTEGER) - åº“å­˜æ•°é‡ï¼ˆå¤‡ç”¨å­—æ®µï¼‰
- `status` (TEXT) - çŠ¶æ€
- `is_new` (BOOLEAN) - æ˜¯å¦æ–°å“
- `discount` (DECIMAL) - æŠ˜æ‰£
- `metadata` (JSONB) - å…ƒæ•°æ®
- `created_at` (TIMESTAMPTZ)
- `updated_at` (TIMESTAMPTZ)

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æ­¥éª¤ 1ï¼šéªŒè¯ä¿®å¤å·²ç”Ÿæ•ˆ

å¼€å‘æœåŠ¡å™¨åº”è¯¥è‡ªåŠ¨çƒ­æ›´æ–°ã€‚å¦‚æœæ²¡æœ‰ï¼Œæ‰‹åŠ¨é‡å¯ï¼š
```bash
# æŒ‰ Ctrl+C åœæ­¢
npm run dev
```

### æ­¥éª¤ 2ï¼šæµ‹è¯•åŠ å…¥è´­ç‰©è½¦

1. è®¿é—®ä»»æ„å•†å“è¯¦æƒ…é¡µï¼Œä¾‹å¦‚ï¼š
   - http://localhost:3000/store/tie-dye-bag
   - http://localhost:3000/store/33333333-3333-3333-3333-333333333333

2. é€‰æ‹©è§„æ ¼ï¼ˆé¢œè‰²/å°ºå¯¸ï¼Œå¦‚æœéœ€è¦ï¼‰

3. ç‚¹å‡» **"åŠ å…¥è´­ç‰©è½¦"** æŒ‰é’®

4. **é¢„æœŸç»“æœï¼š**
   - æ˜¾ç¤º "æ·»åŠ æˆåŠŸ" æç¤º
   - å³ä¸Šè§’è´­ç‰©è½¦å›¾æ ‡æ˜¾ç¤ºæ•°é‡
   - æ²¡æœ‰ 404 æˆ– 500 é”™è¯¯

### æ­¥éª¤ 3ï¼šéªŒè¯è´­ç‰©è½¦é¡µé¢

1. è®¿é—® http://localhost:3000/cart

2. **åº”è¯¥çœ‹åˆ°ï¼š**
   - åˆšæ‰æ·»åŠ çš„å•†å“
   - å•†å“å›¾ç‰‡ã€åç§°ã€ä»·æ ¼
   - æ•°é‡è°ƒæ•´æŒ‰é’®
   - æ€»ä»·è®¡ç®—æ­£ç¡®

### æ­¥éª¤ 4ï¼šæµ‹è¯•ç«‹å³è´­ä¹°

1. åœ¨å•†å“è¯¦æƒ…é¡µç‚¹å‡» **"ç«‹å³è´­ä¹°"**

2. **é¢„æœŸç»“æœï¼š**
   - è‡ªåŠ¨è·³è½¬åˆ°è´­ç‰©è½¦é¡µé¢
   - å•†å“å·²æ·»åŠ åˆ°è´­ç‰©è½¦

## ğŸ” è°ƒè¯•å·¥å…·

å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è°ƒè¯• APIï¼š

### 1. æ£€æŸ¥äº§å“è¡¨å­—æ®µ
```
GET http://localhost:3000/api/debug/check-products-schema
```

è¿”å›ç¤ºä¾‹ï¼š
```json
{
  "success": true,
  "fields": ["id", "slug", "name", "price", ...],
  "sampleProduct": { ... }
}
```

### 2. æ£€æŸ¥äº§å“æ•°æ®
```
GET http://localhost:3000/api/debug/check-products
```

### 3. æ£€æŸ¥è¯¾ç¨‹æ•°æ®
```
GET http://localhost:3000/api/debug/courses
```

## ğŸ¯ éªŒè¯æ¸…å•

- [ ] åŠ å…¥è´­ç‰©è½¦åŠŸèƒ½æ­£å¸¸ï¼ˆæ—  404/500 é”™è¯¯ï¼‰
- [ ] è´­ç‰©è½¦é¡µé¢æ˜¾ç¤ºå•†å“
- [ ] è´­ç‰©è½¦æ•°é‡æ›´æ–°æ­£ç¡®
- [ ] ç«‹å³è´­ä¹°åŠŸèƒ½æ­£å¸¸
- [ ] è¯¾ç¨‹æ”¶è—åŠŸèƒ½æ­£å¸¸
- [ ] å•†å“æ”¶è—åŠŸèƒ½æ­£å¸¸

## âš ï¸ å¦‚æœè¿˜æœ‰é—®é¢˜

### é—®é¢˜ 1ï¼šä»ç„¶æŠ¥ `in_stock` ä¸å­˜åœ¨

**å¯èƒ½åŸå› ï¼š** ä»£ç æœªçƒ­æ›´æ–°

**è§£å†³æ–¹æ¡ˆï¼š**
1. å®Œå…¨é‡å¯å¼€å‘æœåŠ¡å™¨
2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
3. æ£€æŸ¥ `app/api/cart/route.ts` ç¬¬ 197 è¡Œæ˜¯å¦å·²æ”¹ä¸º `stock_quantity`

### é—®é¢˜ 2ï¼šæŠ¥ `stock_quantity` ä¸å­˜åœ¨

**å¯èƒ½åŸå› ï¼š** `products` è¡¨ç¼ºå°‘è¯¥å­—æ®µ

**è§£å†³æ–¹æ¡ˆï¼š**

åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œï¼š
```sql
-- æ·»åŠ  stock_quantity å­—æ®µ
ALTER TABLE products 
  ADD COLUMN IF NOT EXISTS stock_quantity INTEGER DEFAULT 100;

-- åˆ·æ–°ç¼“å­˜
NOTIFY pgrst, 'reload schema';
```

### é—®é¢˜ 3ï¼šäº§å“ ID æ ¼å¼é”™è¯¯

**ç—‡çŠ¶ï¼š** ç»ˆç«¯æ˜¾ç¤ºçš„ `product_id` ä¸æ˜¯ UUID æ ¼å¼

**æ£€æŸ¥ï¼š**
1. æµè§ˆå™¨æ§åˆ¶å°ä¸­æŸ¥çœ‹ `ğŸ›’ [ProductDetail] å‡†å¤‡åŠ å…¥è´­ç‰©è½¦:` æ—¥å¿—
2. ç¡®è®¤ `product_id` æ˜¯ 36 å­—ç¬¦çš„ UUID

**è§£å†³æ–¹æ¡ˆï¼š**
- ç¡®ä¿äº§å“è¯¦æƒ…é¡µé¢ä¼ é€’æ­£ç¡®çš„ `product.id`
- æ£€æŸ¥ `/api/products/[id]` è¿”å›çš„æ•°æ®æ ¼å¼

## ğŸ“ ç›¸å…³æ–‡ä»¶

å·²ä¿®æ”¹çš„æ–‡ä»¶ï¼š
- âœ… `app/api/cart/route.ts` - ä¿®å¤å­—æ®µå
- âœ… `app/api/user/favorites/route.ts` - æ·»åŠ è°ƒè¯•æ—¥å¿—
- âœ… `hooks/use-favorites.ts` - ä¿®å¤è¯¾ç¨‹æ”¶è—
- âœ… `app/teaching/page.tsx` - ä» API è·å–è¯¾ç¨‹

æ–°å¢çš„è°ƒè¯•å·¥å…·ï¼š
- âœ… `app/api/debug/check-products-schema/route.ts`
- âœ… `app/api/debug/courses/route.ts`

## ğŸš€ åç»­æ­¥éª¤

1. **æµ‹è¯•å®Œæ•´æµç¨‹ï¼š**
   - æµè§ˆå•†å“ â†’ åŠ å…¥è´­ç‰©è½¦ â†’ æŸ¥çœ‹è´­ç‰©è½¦ â†’ ç»“ç®—
   - æµè§ˆè¯¾ç¨‹ â†’ æ”¶è—è¯¾ç¨‹ â†’ æŸ¥çœ‹æ”¶è—

2. **éªŒè¯æ•°æ®ä¸€è‡´æ€§ï¼š**
   - æ‰€æœ‰å•†å“ ID ä¸º UUID æ ¼å¼
   - æ‰€æœ‰è¯¾ç¨‹ ID ä¸º UUID æ ¼å¼
   - æ”¶è—åˆ—è¡¨æ­£ç¡®æ˜¾ç¤ºå•†å“å’Œè¯¾ç¨‹

3. **æ€§èƒ½ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰ï¼š**
   - ç§»é™¤è°ƒè¯•æ—¥å¿—ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
   - æ·»åŠ è¯·æ±‚ç¼“å­˜
   - ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢

## âœ¨ åŠŸèƒ½çŠ¶æ€

| åŠŸèƒ½ | çŠ¶æ€ | å¤‡æ³¨ |
|------|------|------|
| å•†å“åˆ—è¡¨ | âœ… | æ­£å¸¸ |
| å•†å“è¯¦æƒ… | âœ… | æ­£å¸¸ |
| åŠ å…¥è´­ç‰©è½¦ | âœ… | å·²ä¿®å¤ |
| è´­ç‰©è½¦é¡µé¢ | âœ… | æ­£å¸¸ |
| ç«‹å³è´­ä¹° | âœ… | åº”è¯¥æ­£å¸¸ |
| å•†å“æ”¶è— | âœ… | æ­£å¸¸ |
| è¯¾ç¨‹åˆ—è¡¨ | âœ… | æ­£å¸¸ |
| è¯¾ç¨‹æ”¶è— | âš ï¸ | éœ€è¦ä¿®å¤çº¦æŸ |
| æ”¶è—é¡µé¢ | âœ… | æ­£å¸¸ |

---

**æœ€åæ›´æ–°ï¼š** 2025-11-21 16:24
**ä¿®å¤ç‰ˆæœ¬ï¼š** v1.0
