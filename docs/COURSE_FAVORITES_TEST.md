# 课程收藏功能测试指南

## ✅ 已完成的工作

### 1. 数据库设置
- ✅ 创建了 `courses` 表（8门课程）
- ✅ 创建了 `course_chapters` 表（所有课程章节）
- ✅ 修改了 `favorites` 表支持 `course_id`
- ✅ 运行了种子脚本，数据已导入

### 2. 后端 API
- ✅ `/api/courses` - 获取课程列表
- ✅ `/api/courses/[id]` - 获取单个课程
- ✅ `/api/user/favorites` 支持课程收藏
  - GET: 返回商品和课程收藏
  - POST: 支持 `{ courseId: "uuid" }`
  - DELETE: 支持 `{ courseId: "uuid" }`

### 3. 前端更新
- ✅ `use-favorites.ts` - 课程收藏功能已启用
- ✅ `course-card.tsx` - 收藏按钮已启用
- ✅ `course-list-card.tsx` - 收藏按钮已启用
- ✅ `/app/teaching/page.tsx` - 从API获取真实课程数据
- ✅ 收藏页面支持显示课程

## 🧪 测试步骤

### 步骤 1：重启开发服务器

如果服务器正在运行，请重启：

```bash
# 按 Ctrl+C 停止
npm run dev
```

### 步骤 2：测试课程列表

1. 访问 http://localhost:3000/teaching
2. **应该看到 8 门课程：**
   - 传统扎染基础入门课程（免费）
   - 扎染进阶技法与创作（¥168）
   - 现代扎染艺术创作（¥198）
   - 扎染工艺与商业应用（¥128）
   - 蜡染工艺基础入门（¥199）
   - 传统苗族蜡染技法（¥258）
   - 蜡染纹样设计与应用（¥178）
   - 蜡染与扎染结合创作（¥238）

### 步骤 3：测试课程收藏

1. **确保已登录**（如未登录，点收藏会提示登录）

2. **收藏课程：**
   - 鼠标悬停在任意课程卡片上
   - 右上角应该出现**心形收藏按钮**
   - 点击收藏按钮
   - 应该显示 "收藏成功" 提示
   - 心形图标变为红色填充

3. **查看收藏列表：**
   - 访问 http://localhost:3000/profile/favorites
   - 切换到 **"课程收藏"** 标签
   - 应该看到刚才收藏的课程
   - 课程应该显示：
     - 标题
     - 讲师名称
     - 时长
     - 学生人数
     - 价格（或"免费"）

4. **取消收藏：**
   - 在收藏页面或课程列表页
   - 再次点击已收藏的课程心形按钮
   - 应该显示 "取消收藏成功"
   - 心形图标变回空心
   - 课程从收藏列表中消失

### 步骤 4：测试商品收藏（确保未破坏）

1. 访问 http://localhost:3000/store
2. 点击商品卡片的心形图标收藏
3. 访问 http://localhost:3000/profile/favorites
4. **"商品收藏"** 标签应该显示收藏的商品（带图片）

### 步骤 5：测试购物车（确保未破坏）

1. 访问商品详情页
2. 点击 "加入购物车"
3. 访问 http://localhost:3000/cart
4. 应该看到刚添加的商品

## 🐛 常见问题排查

### 问题 1：课程列表为空

**原因：** 课程数据未正确导入

**解决：**
1. 访问 http://localhost:3000/api/courses
2. 应该返回 8 门课程的 JSON 数据
3. 如果为空，重新运行：`node scripts/seed-courses.js`

### 问题 2：收藏按钮不显示

**检查：**
1. 鼠标是否悬停在课程卡片上（按钮在 hover 时显示）
2. 浏览器控制台是否有错误
3. 课程卡片是否设置了 `showFavorite={true}`

### 问题 3：点击收藏无反应

**检查：**
1. 是否已登录
2. 浏览器控制台的网络请求：
   - `POST /api/user/favorites` 应该是 200
   - 如果是 401，需要重新登录
   - 如果是 400/500，查看错误信息

**调试：**
```javascript
// 在浏览器控制台执行
localStorage.getItem('supabase.auth.token') // 检查是否有 token
```

### 问题 4：收藏列表不显示课程

**检查：**
1. 访问 http://localhost:3000/api/user/favorites
2. 应该返回类似：
   ```json
   {
     "favorites": [
       {
         "id": "...",
         "course_id": "c0000001-...",
         "item_type": "course",
         "courses": {
           "id": "c0000001-...",
           "title": "传统扎染基础入门课程",
           ...
         }
       }
     ]
   }
   ```

3. 如果 `courses` 字段为 `null`，说明数据库查询有问题

### 问题 5：课程 ID 不匹配

**症状：** 收藏成功但列表中不显示，或收藏按钮状态不对

**原因：** 课程 ID 格式不一致

**检查：**
1. 课程列表中使用的 ID 格式（应该是 UUID）
2. 收藏 API 传递的 ID 格式
3. 确保都是完整的 UUID，如 `c0000001-0001-0001-0001-000000000001`

## 📊 预期行为

### 课程数据
- **总数：** 8 门课程
- **免费课程：** 1 门（传统扎染基础入门课程）
- **付费课程：** 7 门（价格从 ¥128 到 ¥258）
- **分类：** 扎染（4门）、蜡染（4门）
- **难度：** 入门（2门）、进阶（4门）、高级（2门）

### 收藏功能
- **商品收藏：** 显示商品图片、名称、价格
- **课程收藏：** 显示课程缩略图、标题、讲师、时长、价格
- **收藏计数：** 页面标题显示收藏数量，如 "商品收藏 (4)"

### API 响应
- **GET /api/courses** - 200, 返回 8 门课程
- **GET /api/courses/[id]** - 200, 返回课程详情和章节
- **POST /api/user/favorites** (course) - 200, 返回 `{ success: true }`
- **DELETE /api/user/favorites** (course) - 200, 返回 `{ success: true }`
- **GET /api/user/favorites** - 200, 返回商品和课程收藏

## ✨ 功能特性

1. **课程收藏：**
   - ✅ 在课程列表页收藏/取消收藏
   - ✅ 收藏状态持久化到数据库
   - ✅ 收藏按钮状态实时更新
   - ✅ 收藏列表页显示所有收藏的课程

2. **商品收藏：**
   - ✅ 保持原有功能不变
   - ✅ 商品图片正确显示
   - ✅ 商品收藏与课程收藏独立

3. **统一管理：**
   - ✅ 同一个收藏页面管理商品和课程
   - ✅ 两个独立的标签页切换
   - ✅ 显示各自的收藏数量

## 🎯 成功标准

- [ ] 课程列表显示 8 门课程
- [ ] 课程卡片显示收藏按钮
- [ ] 点击收藏按钮成功收藏课程
- [ ] 收藏列表正确显示收藏的课程
- [ ] 取消收藏功能正常
- [ ] 商品收藏功能未受影响
- [ ] 购物车功能未受影响

## 📝 测试完成后

如果所有测试通过，课程收藏功能就完全可用了！

如果遇到问题，请提供：
1. 浏览器控制台错误信息
2. 网络请求的响应数据
3. 具体的操作步骤和预期/实际结果
