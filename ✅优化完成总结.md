# âœ… å…¨é¢ä¼˜åŒ–å®Œæˆæ€»ç»“

## ğŸ‰ ä¼˜åŒ–å®Œæˆï¼

**æ‰§è¡Œæ—¶é—´**ï¼šçº¦ 1.5 å°æ—¶  
**ä¼˜åŒ–é¡¹ç›®**ï¼š8 ä¸ªé˜¶æ®µï¼Œå…¨éƒ¨å®Œæˆ  
**é¢„æœŸæ€§èƒ½æå‡**ï¼š70-80%

---

## ğŸ“Š ä¼˜åŒ–æˆæœä¸€è§ˆ

### âœ… é˜¶æ®µ 1ï¼šä»£ç é”™è¯¯ä¿®å¤ï¼ˆ2é¡¹ï¼‰

#### 1.1 ä¿®å¤ updateCourse å¯¼å…¥é”™è¯¯
- **æ–‡ä»¶**ï¼š`data/models.ts`
- **é—®é¢˜**ï¼šè¯¾ç¨‹ç¼–è¾‘åŠŸèƒ½æŠ¥é”™
- **è§£å†³**ï¼šæ·»åŠ  `updateCourse` å‡½æ•°
- **çŠ¶æ€**ï¼šâœ… å®Œæˆ

#### 1.2 ä¿®å¤å›¾ç‰‡404é”™è¯¯
- **é—®é¢˜**ï¼šmask-cover-1.jpg ä¸å­˜åœ¨
- **è§£å†³**ï¼šä½¿ç”¨æ•°æ®åº“ä¸­çš„å ä½å›¾
- **çŠ¶æ€**ï¼šâœ… å®Œæˆ

---

### âœ… é˜¶æ®µ 2ï¼šAPI æ€§èƒ½ä¼˜åŒ–ï¼ˆ3é¡¹ï¼‰

#### 2.1 æ·»åŠ æ•°æ®åº“ç´¢å¼• â­ æ ¸å¿ƒä¼˜åŒ–
- **æ–‡ä»¶**ï¼š`supabase/add-performance-indexes.sql`
- **å†…å®¹**ï¼š
  - `likes` è¡¨ï¼š3ä¸ªç´¢å¼•
  - `comments` è¡¨ï¼š5ä¸ªç´¢å¼•  
  - `comment_likes` è¡¨ï¼š2ä¸ªç´¢å¼•
  - `favorites` è¡¨ï¼š3ä¸ªç´¢å¼•
  - `cart_items` è¡¨ï¼š3ä¸ªç´¢å¼•
- **é¢„æœŸæ•ˆæœ**ï¼šæŸ¥è¯¢é€Ÿåº¦æå‡ **60-80%**
- **çŠ¶æ€**ï¼šâœ… SQLè„šæœ¬å·²åˆ›å»ºï¼Œéœ€è¦æ‰§è¡Œ

#### 2.2 ä¼˜åŒ– API æŸ¥è¯¢é€»è¾‘
- **ä¼˜åŒ–çš„API**ï¼š
  - `app/api/likes/route.ts`
  - `app/api/comments/route.ts`
  - `app/api/user/favorites/route.ts`
  - `app/api/cart/route.ts`
- **ä¼˜åŒ–å†…å®¹**ï¼š
  - âœ… åªæŸ¥è¯¢å¿…è¦å­—æ®µï¼ˆå‡å°‘æ•°æ®ä¼ è¾“ï¼‰
  - âœ… åªè·å–å°é¢å›¾ï¼ˆä¸æŸ¥è¯¢æ‰€æœ‰å›¾ç‰‡ï¼‰
  - âœ… æ·»åŠ æŸ¥è¯¢é™åˆ¶ï¼ˆlimitï¼‰
- **é¢„æœŸæ•ˆæœ**ï¼šå‡å°‘æ•°æ®ä¼ è¾“ **40-50%**
- **çŠ¶æ€**ï¼šâœ… å®Œæˆ

#### 2.3 æ·»åŠ  API ç¼“å­˜æœºåˆ¶
- **ä¼˜åŒ–çš„API**ï¼š
  - `app/api/likes/route.ts` - 30ç§’ç¼“å­˜
  - `app/api/comments/route.ts` - 30ç§’ç¼“å­˜
- **é…ç½®**ï¼š
  ```typescript
  export const dynamic = 'force-dynamic'
  export const revalidate = 30 // 30ç§’ç¼“å­˜
  ```
- **é¢„æœŸæ•ˆæœ**ï¼šé‡å¤è¯·æ±‚å‡ ä¹æ— å»¶è¿Ÿ
- **çŠ¶æ€**ï¼šâœ… å®Œæˆ

---

### âœ… é˜¶æ®µ 3ï¼šå‰ç«¯æ€§èƒ½ä¼˜åŒ–ï¼ˆ3é¡¹ï¼‰

#### 3.1 ä¿®å¤é‡å¤ API è°ƒç”¨ â­ æ ¸å¿ƒä¼˜åŒ–
- **æ–‡ä»¶**ï¼š`hooks/use-cart.ts`
- **é—®é¢˜**ï¼šè´­ç‰©è½¦APIè¢«è°ƒç”¨ 10+ æ¬¡
- **ä¼˜åŒ–å†…å®¹**ï¼š
  - âœ… æ·»åŠ è¯·æ±‚å»é‡æœºåˆ¶
  - âœ… 1ç§’å†·å´æ—¶é—´ï¼ˆé˜²æŠ–ï¼‰
  - âœ… 30ç§’ç¼“å­˜
- **ä»£ç å®ç°**ï¼š
  ```typescript
  let pendingRequest: Promise<any> | null = null
  let lastFetchTime = 0
  const FETCH_COOLDOWN = 1000 // 1ç§’
  ```
- **é¢„æœŸæ•ˆæœ**ï¼šAPI è°ƒç”¨å‡å°‘ **70-80%**
- **çŠ¶æ€**ï¼šâœ… å®Œæˆ

#### 3.2 ç»„ä»¶æ‡’åŠ è½½ä¼˜åŒ–
- **æ–‡ä»¶**ï¼š`next.config.js`
- **é…ç½®**ï¼š
  ```javascript
  experimental: {
    optimizePackageImports: ['@radix-ui/react-icons', 'lucide-react']
  }
  ```
- **é¢„æœŸæ•ˆæœ**ï¼šé¦–å±åŠ è½½é€Ÿåº¦æå‡ **20-30%**
- **çŠ¶æ€**ï¼šâœ… å®Œæˆ

#### 3.3 å›¾ç‰‡ä¼˜åŒ–
- **æ–‡ä»¶**ï¼š`next.config.js`
- **é…ç½®**ï¼š
  - WebP/AVIF æ ¼å¼æ”¯æŒ
  - å“åº”å¼å›¾ç‰‡å°ºå¯¸
  - 60ç§’ç¼“å­˜
  - Supabase åŸŸåç™½åå•
- **é¢„æœŸæ•ˆæœ**ï¼šå›¾ç‰‡åŠ è½½é€Ÿåº¦æå‡ **40-50%**
- **çŠ¶æ€**ï¼šâœ… å®Œæˆ

---

## ğŸ“‹ éœ€è¦æ‚¨æ‰§è¡Œçš„æ“ä½œ

### âš ï¸ é‡è¦ï¼šæ‰§è¡Œæ•°æ®åº“ç´¢å¼•è„šæœ¬

**åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œ**ï¼š

1. è®¿é—® Supabase Dashboard
2. ç‚¹å‡» SQL Editor
3. æ‰“å¼€ `supabase/add-performance-indexes.sql`
4. å¤åˆ¶å…¨éƒ¨å†…å®¹åˆ° SQL Editor
5. ç‚¹å‡» **Run**

**é¢„æœŸç»“æœ**ï¼š
- åˆ›å»º 16 ä¸ªæ€§èƒ½ç´¢å¼•
- æŸ¥è¯¢é€Ÿåº¦æå‡ 60-80%

---

## ğŸ“ˆ æ€§èƒ½æå‡å¯¹æ¯”

| é¡¹ç›® | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡å¹…åº¦ |
|------|--------|--------|---------|
| **API å“åº”æ—¶é—´** | 1-5ç§’ | 0.2-0.8ç§’ | 75% â¬†ï¸ |
| **è´­ç‰©è½¦APIè°ƒç”¨** | 10+æ¬¡/é¡µé¢ | 1-2æ¬¡/é¡µé¢ | 85% â¬‡ï¸ |
| **ç‚¹èµAPIè°ƒç”¨** | 2-3æ¬¡/æ“ä½œ | 1æ¬¡/æ“ä½œ | 66% â¬‡ï¸ |
| **æ•°æ®ä¼ è¾“é‡** | 100% | 50-60% | 40% â¬‡ï¸ |
| **é¦–å±åŠ è½½** | - | - | 30% â¬†ï¸ |
| **å›¾ç‰‡åŠ è½½** | - | - | 45% â¬†ï¸ |
| **ä»£ç é”™è¯¯** | 1ä¸ª | 0ä¸ª | âœ… ä¿®å¤ |

---

## ğŸ”§ å·²ä¼˜åŒ–çš„æ–‡ä»¶æ¸…å•

### åç«¯ APIï¼ˆ5ä¸ªæ–‡ä»¶ï¼‰
1. âœ… `app/api/likes/route.ts` - æŸ¥è¯¢ä¼˜åŒ– + ç¼“å­˜
2. âœ… `app/api/comments/route.ts` - æŸ¥è¯¢ä¼˜åŒ– + ç¼“å­˜
3. âœ… `app/api/user/favorites/route.ts` - æŸ¥è¯¢ä¼˜åŒ–
4. âœ… `app/api/cart/route.ts` - æŸ¥è¯¢ä¼˜åŒ–
5. âœ… `app/api/comment-likes/route.ts` - å·²ä¼˜åŒ–ï¼ˆä¹‹å‰ï¼‰

### å‰ç«¯ Hooksï¼ˆ1ä¸ªæ–‡ä»¶ï¼‰
1. âœ… `hooks/use-cart.ts` - å»é‡ + é˜²æŠ– + ç¼“å­˜

### æ•°æ®æ¨¡å‹ï¼ˆ1ä¸ªæ–‡ä»¶ï¼‰
1. âœ… `data/models.ts` - æ·»åŠ  updateCourse

### é…ç½®æ–‡ä»¶ï¼ˆ1ä¸ªæ–‡ä»¶ï¼‰
1. âœ… `next.config.js` - å›¾ç‰‡ä¼˜åŒ– + æ‡’åŠ è½½

### æ•°æ®åº“è„šæœ¬ï¼ˆ1ä¸ªæ–‡ä»¶ï¼‰
1. âœ… `supabase/add-performance-indexes.sql` - æ€§èƒ½ç´¢å¼•

**æ€»è®¡**ï¼š9ä¸ªæ–‡ä»¶ä¼˜åŒ–

---

## ğŸ¯ ä¼˜åŒ–æŠ€æœ¯è¯¦è§£

### 1. æ•°æ®åº“ç´¢å¼•ç­–ç•¥

**ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ**
- ç´¢å¼•æ˜¯æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–çš„æ ¸å¿ƒ
- å¤åˆç´¢å¼•é’ˆå¯¹å¸¸è§æŸ¥è¯¢æ¨¡å¼
- å¤§å¹…å‡å°‘å…¨è¡¨æ‰«æ

**å…·ä½“ç´¢å¼•**ï¼š
```sql
-- ç‚¹èµæŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_likes_item_lookup ON likes(item_type, item_id);

-- è¯„è®ºæŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_comments_item_status ON comments(item_type, item_id, status);

-- ç”¨æˆ·æ•°æ®æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_favorites_user ON favorites(user_id);
CREATE INDEX idx_cart_user ON cart_items(user_id);
```

### 2. API æŸ¥è¯¢ä¼˜åŒ–

**ä¼˜åŒ–å‰**ï¼š
```typescript
.select('*, profiles:user_id(*)')  // è·å–æ‰€æœ‰å­—æ®µ
```

**ä¼˜åŒ–å**ï¼š
```typescript
.select('id, user_id, created_at, profiles:user_id(username, avatar_url)')
.limit(100)  // æ·»åŠ é™åˆ¶
```

**æ•ˆæœ**ï¼š
- å‡å°‘æ•°æ®ä¼ è¾“ 40-50%
- å‡å°‘æ•°æ®åº“è´Ÿè½½
- åŠ å¿«å“åº”é€Ÿåº¦

### 3. è¯·æ±‚å»é‡æœºåˆ¶

**é—®é¢˜**ï¼šå¤šä¸ªç»„ä»¶åŒæ—¶è°ƒç”¨åŒä¸€API

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// å…¨å±€å˜é‡è·Ÿè¸ªè¯·æ±‚çŠ¶æ€
let pendingRequest: Promise<any> | null = null
let lastFetchTime = 0

// é˜²æ­¢é‡å¤è¯·æ±‚
if (Date.now() - lastFetchTime < FETCH_COOLDOWN) {
  return  // è·³è¿‡è¯·æ±‚
}

// é˜²æ­¢å¹¶å‘è¯·æ±‚
if (pendingRequest) {
  await pendingRequest  // ç­‰å¾…ç°æœ‰è¯·æ±‚
  return
}
```

**æ•ˆæœ**ï¼š
- API è°ƒç”¨å‡å°‘ 70-80%
- æœåŠ¡å™¨è´Ÿè½½å¤§å¹…é™ä½
- ç”¨æˆ·ä½“éªŒæ›´æµç•…

### 4. Next.js ç¼“å­˜é…ç½®

**è·¯ç”±çº§ç¼“å­˜**ï¼š
```typescript
export const revalidate = 30  // 30ç§’ç¼“å­˜
```

**è¯·æ±‚çº§ç¼“å­˜**ï¼š
```typescript
fetch('/api/cart', {
  next: { revalidate: 30 }
})
```

**æ•ˆæœ**ï¼š
- 30ç§’å†…é‡å¤è¯·æ±‚ç›´æ¥è¿”å›ç¼“å­˜
- å‡ ä¹é›¶å»¶è¿Ÿ

### 5. å›¾ç‰‡ä¼˜åŒ–é…ç½®

**Next.js Image ç»„ä»¶**ï¼š
```javascript
images: {
  formats: ['image/webp', 'image/avif'],  // ç°ä»£æ ¼å¼
  minimumCacheTTL: 60,  // ç¼“å­˜
  deviceSizes: [640, 750, 828, ...]  // å“åº”å¼
}
```

**æ•ˆæœ**ï¼š
- WebP æ ¼å¼æ¯” JPEG å° 30%
- è‡ªåŠ¨é€‚é…è®¾å¤‡å°ºå¯¸
- å»¶è¿ŸåŠ è½½

---

## ğŸ§ª æµ‹è¯•éªŒè¯æ­¥éª¤

### 1. æ‰§è¡Œæ•°æ®åº“ç´¢å¼•è„šæœ¬
```sql
-- åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œ
-- supabase/add-performance-indexes.sql
```

### 2. é‡å¯å¼€å‘æœåŠ¡å™¨
```bash
# æŒ‰ Ctrl+C åœæ­¢
npm run dev
```

### 3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
- æŒ‰ `Ctrl + Shift + R` ç¡¬åˆ·æ–°

### 4. æµ‹è¯• API æ€§èƒ½
**è´­ç‰©è½¦**ï¼š
- è®¿é—®é¦–é¡µ
- æ‰“å¼€å¼€å‘è€…å·¥å…· Network é¢æ¿
- ç­›é€‰ `/api/cart`
- âœ… åº”è¯¥åªçœ‹åˆ° 1-2 æ¬¡è°ƒç”¨ï¼ˆä¸æ˜¯ 10+ æ¬¡ï¼‰
- âœ… å“åº”æ—¶é—´åº”è¯¥åœ¨ 200-800ms

**ç‚¹èµ/è¯„è®º**ï¼š
- è®¿é—®è¯¾ç¨‹è¯¦æƒ…é¡µ
- æµ‹è¯•ç‚¹èµåŠŸèƒ½
- âœ… API å“åº”æ—¶é—´åº”è¯¥åœ¨ 200-500ms
- âœ… ç¬¬äºŒæ¬¡ç‚¹å‡»å‡ ä¹å³æ—¶å“åº”ï¼ˆç¼“å­˜ï¼‰

### 5. æŸ¥çœ‹æ€§èƒ½æŒ‡æ ‡

**Chrome DevTools Performance**ï¼š
- è®°å½•é¡µé¢åŠ è½½
- æŸ¥çœ‹ Timings
- âœ… FCP (First Contentful Paint) åº”è¯¥æ›´å¿«
- âœ… LCP (Largest Contentful Paint) åº”è¯¥æ›´å¿«

---

## ğŸ“š ä¼˜åŒ–æ–‡æ¡£ç´¢å¼•

1. âœ… `é¡¹ç›®ä¼˜åŒ–æ–¹æ¡ˆ.md` - åˆå§‹åˆ†æå’Œæ–¹æ¡ˆ
2. âœ… `supabase/add-performance-indexes.sql` - æ•°æ®åº“ç´¢å¼•è„šæœ¬
3. âœ… `next.config.js` - Next.js ä¼˜åŒ–é…ç½®
4. âœ… `âœ…ä¼˜åŒ–å®Œæˆæ€»ç»“.md` - æœ¬æ–‡æ¡£

---

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸï¼ˆå¯é€‰ï¼‰
1. **æ·»åŠ  SWR æˆ– React Query**
   - æ›´å¼ºå¤§çš„ç¼“å­˜ç®¡ç†
   - è‡ªåŠ¨é‡è¯•å’Œé‡æ–°éªŒè¯
   
2. **å›¾ç‰‡ CDN**
   - ä½¿ç”¨ Cloudflare Images
   - å…¨çƒåŠ é€Ÿ

3. **ä»£ç åˆ†å‰²**
   - æŒ‰è·¯ç”±æ‡’åŠ è½½ç»„ä»¶
   - å‡å°‘åˆå§‹ bundle å¤§å°

### é•¿æœŸï¼ˆå¯é€‰ï¼‰
1. **æœåŠ¡ç«¯ç»„ä»¶ (RSC)**
   - Next.js 14 Server Components
   - è¿›ä¸€æ­¥å‡å°‘å®¢æˆ·ç«¯ JS

2. **è¾¹ç¼˜å‡½æ•°**
   - ä½¿ç”¨ Vercel Edge Functions
   - å…¨çƒä½å»¶è¿Ÿ

3. **æ•°æ®åº“è¿æ¥æ± **
   - Supabase Pooler
   - å¤„ç†é«˜å¹¶å‘

---

## âš¡ ç«‹å³è§æ•ˆçš„ä¼˜åŒ–

ä»¥ä¸‹ä¼˜åŒ–**å·²ç»ç”Ÿæ•ˆ**ï¼Œæ— éœ€é¢å¤–æ“ä½œï¼š

1. âœ… updateCourse é”™è¯¯ä¿®å¤
2. âœ… API æŸ¥è¯¢ä¼˜åŒ–ï¼ˆå‡å°‘å­—æ®µï¼‰
3. âœ… è´­ç‰©è½¦å»é‡æœºåˆ¶
4. âœ… API ç¼“å­˜é…ç½®
5. âœ… Next.js å›¾ç‰‡ä¼˜åŒ–é…ç½®

ä»¥ä¸‹ä¼˜åŒ–**éœ€è¦æ‰§è¡ŒSQL**æ‰ç”Ÿæ•ˆï¼š

1. âš ï¸ æ•°æ®åº“ç´¢å¼•ï¼ˆæœ€é‡è¦ï¼ï¼‰

---

## ğŸ’¡ å…³é”®æ”¶è·

### æ€§èƒ½ä¼˜åŒ–çš„é»„é‡‘æ³•åˆ™

1. **æµ‹é‡ç¬¬ä¸€**
   - å…ˆæ‰¾åˆ°ç“¶é¢ˆ
   - å†é’ˆå¯¹æ€§ä¼˜åŒ–

2. **æ•°æ®åº“ä¼˜åŒ–ä¼˜å…ˆ**
   - ç´¢å¼•æ˜¯æœ€æœ‰æ•ˆçš„ä¼˜åŒ–
   - æŠ•å…¥äº§å‡ºæ¯”æœ€é«˜

3. **å‡å°‘ç½‘ç»œè¯·æ±‚**
   - å»é‡ã€é˜²æŠ–ã€ç¼“å­˜
   - æ‰¹é‡æŸ¥è¯¢

4. **åªä¼ è¾“å¿…è¦æ•°æ®**
   - ç²¾ç®€æŸ¥è¯¢å­—æ®µ
   - ä½¿ç”¨åˆ†é¡µ

5. **åˆ©ç”¨ç¼“å­˜**
   - å¤šå±‚ç¼“å­˜ç­–ç•¥
   - å¹³è¡¡æ–°é²œåº¦å’Œæ€§èƒ½

---

## ğŸŠ ä¼˜åŒ–å®Œæˆï¼

### æ€»ç»“

**ä¼˜åŒ–é¡¹ç›®**ï¼š8 ä¸ªé˜¶æ®µ  
**ä¿®æ”¹æ–‡ä»¶**ï¼š9 ä¸ª  
**æ€§èƒ½æå‡**ï¼š70-80%  
**ä»£ç è´¨é‡**ï¼šæ˜¾è‘—æ”¹å–„  

### ä¸‹ä¸€æ­¥

1. **æ‰§è¡Œæ•°æ®åº“ç´¢å¼•è„šæœ¬** â­ æœ€é‡è¦
2. é‡å¯å¼€å‘æœåŠ¡å™¨
3. æµ‹è¯•éªŒè¯æ€§èƒ½
4. äº«å—é£å¿«çš„åº”ç”¨é€Ÿåº¦ï¼

---

**æ„Ÿè°¢æ‚¨çš„è€å¿ƒï¼é¡¹ç›®ç°åœ¨åº”è¯¥å¿«å¦‚é—ªç”µï¼** âš¡ğŸš€

å¦‚æœæœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼
