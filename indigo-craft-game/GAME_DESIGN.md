# 蓝染工艺模拟游戏 - 设计文档

## 📋 项目概述

### 游戏名称
**"染蓝时光"** (Indigo Moments) - 蓝染工艺互动模拟游戏

### 核心理念
通过游戏化的方式，让用户沉浸式体验传统蓝染工艺的完整流程，从布料选择、图案设计、扎染技法到浸染上色，每一步都尽可能还原真实的工艺过程，寓教于乐地传承蓝染文化。

### 目标用户
- 对传统工艺感兴趣的年轻用户
- 希望在购买前了解蓝染工艺的潜在客户
- 完成课程学习后想要实践的学员
- 休闲游戏爱好者

---

## 🎮 游戏核心玩法

### 1. 工艺流程模拟（主线玩法）

#### 第一阶段：准备工坊
- **布料选择**：棉布、麻布、丝绸（不同材质有不同染色效果）
- **工具准备**：橡皮筋、绳子、夹子、木板、蜡笔等扎染工具
- **图案库**：解锁传统图案（螺旋、条纹、圆点、方格等）

#### 第二阶段：扎染设计
- **互动式折叠**：
  - 拖拽手势模拟布料折叠（对角折、风琴折、卷筒折）
  - 实时预览折叠效果的 3D 可视化
  - 橡皮筋/绳子捆扎位置标记
  
- **蜡染设计**：
  - 画笔工具在白布上绘制蜡防染图案
  - 提供传统图案模板辅助
  - 笔触粗细、蜡层厚度调节

- **夹染设计**：
  - 夹板选择和摆放
  - 夹紧力度模拟（影响最终效果）

#### 第三阶段：染料调配
- **靛蓝发酵槽**：
  - pH 值调节（模拟建缸过程）
  - 温度控制
  - 发酵时间等待（可加速）
  - 染液颜色浓度预览

- **天然染料知识**：
  - 展示板蓝根、木蓝等植物来源
  - 化学反应科普动画

#### 第四阶段：浸染过程
- **浸染操作**：
  - 布料下缸动画（浸入-提起-氧化循环）
  - 浸染次数控制（1-8次，影响深浅）
  - 氧化显色动画（绿色→蓝色的魔法变化）
  - 时间管理：每次浸染需等待真实时间（可用道具加速）

- **实时效果预览**：
  - 根据扎法、浸染次数实时渲染最终效果
  - 扎痕、晕染边缘的真实模拟

#### 第五阶段：后处理
- **拆解过程**：
  - 小游戏：按顺序拆除橡皮筋/蜡层
  - 揭晓最终图案的"开盲盒"体验
  
- **水洗固色**：
  - 清水漂洗动画
  - 去除浮色和杂质

- **晾晒成品**：
  - 悬挂晾晒动画
  - 成品展示旋转预览

---

## 🎯 游戏系统设计

### 关卡系统
**新手引导关**（5关）
1. 基础扎染 - 螺旋纹手帕
2. 条纹围巾制作
3. 圆点图案抱枕套
4. 蜡染入门 - 简单花卉
5. 综合挑战 - 设计专属T恤

**进阶关卡**（15关）
- 传统纹样复刻（冰裂纹、云纹、水波纹等）
- 多色叠染技法
- 大型作品（桌布、窗帘、床单）
- 限时挑战模式

**大师关卡**（10关）
- 复杂图案自由创作
- 还原博物馆珍品
- 创新技法探索

### 成就系统
- **工艺大师**：完成所有关卡
- **完美主义者**：10次连续满分作品
- **色彩魔术师**：解锁所有染料配方
- **速度之神**：限时模式全通
- **收藏家**：收集50个传统图案
- **创新者**：创作10个原创设计

### 资源系统
**货币：蓝染币**
- 完成关卡获得
- 每日签到奖励
- 观看教学视频获取

**用途：**
- 解锁高级布料
- 购买特殊工具
- 加速浸染时间
- 购买图案模板

### 社交功能
- **作品展厅**：展示个人最佳作品
- **排行榜**：关卡评分、创作数量、成就数
- **分享功能**：导出作品图片到社交平台
- **挑战模式**：邀请好友完成相同图案

---

## 🎨 视觉与交互设计

### 美术风格
- **写实与手绘结合**：
  - 布料材质：真实的纹理和光泽
  - 工具：手绘插画风格
  - 背景：水墨画风格的工坊场景
  
- **动画细节**：
  - 流体动画模拟染液流动
  - 布料摆动的物理效果
  - 氧化显色的渐变动画

### UI/UX 设计
**游戏界面布局：**
```
┌─────────────────────────────────┐
│   [返回] 染蓝时光 [设置] [帮助]   │
├─────────────────────────────────┤
│                                 │
│       工作台区域                 │
│    (3D Canvas 交互区)            │
│                                 │
│                                 │
├─────────────────────────────────┤
│ 工具栏：[折叠] [捆扎] [染色]     │
│ 资源：蓝染币:500 | 关卡: 3/30    │
└─────────────────────────────────┘
```

**交互方式：**
- 拖拽：布料折叠、工具摆放
- 点击：工具选择、操作确认
- 滑动：染液浓度调节、浸染次数
- 长按：查看工具/图案详情

### 音效与音乐
- **背景音乐**：古风轻音乐，营造宁静工坊氛围
- **操作音效**：
  - 布料翻折声
  - 橡皮筋绷紧声
  - 水流声（浸染时）
  - 成功提示音（完成作品）

---

## 🛠️ 技术实现方案

### 前端架构
```
indigo-craft-game/
├── components/           # 游戏组件
│   ├── GameCanvas.tsx   # 主游戏画布
│   ├── FabricEditor.tsx # 布料编辑器
│   ├── DyeSimulator.tsx # 染色模拟器
│   ├── ToolBar.tsx      # 工具栏
│   └── ui/              # 游戏UI组件
├── game-logic/          # 游戏逻辑
│   ├── dyeAlgorithm.ts  # 染色算法
│   ├── patternEngine.ts # 图案生成引擎
│   ├── physicsEngine.ts # 简单物理引擎
│   └── levelManager.ts  # 关卡管理
├── assets/              # 游戏资源
│   ├── patterns/        # 图案资源
│   ├── tools/           # 工具图片
│   └── sounds/          # 音效文件
├── hooks/               # 自定义 Hooks
│   ├── useGameState.ts  # 游戏状态管理
│   ├── useCanvas.ts     # Canvas 操作
│   └── useProgress.ts   # 进度保存
└── types/               # TypeScript 类型
    └── game.types.ts
```

### 核心技术选型

#### 1. 图形渲染
**Canvas API + Fabric.js**
- Fabric.js 处理复杂的图形操作和交互
- 自定义 shader 模拟扎染效果
- 支持图层管理和实时预览

#### 2. 染色算法
```typescript
// 伪代码示例
interface DyeEffect {
  foldPattern: FoldType;      // 折叠类型
  bindPoints: Point[];        // 捆绑点
  dyeIntensity: number;       // 染料浓度
  dips: number;               // 浸染次数
}

function simulateDyeEffect(fabric: Fabric, effect: DyeEffect): ImageData {
  // 1. 根据折叠模式生成遮罩
  const mask = generateFoldMask(effect.foldPattern, effect.bindPoints);
  
  // 2. 应用染色渐变（边缘晕染效果）
  const gradient = calculateDyeGradient(mask, effect.dyeIntensity);
  
  // 3. 叠加多次浸染
  for (let i = 0; i < effect.dips; i++) {
    applyDyeLayer(fabric, gradient);
  }
  
  return fabric.toImageData();
}
```

#### 3. 状态管理
**Zustand 轻量级状态管理**
```typescript
interface GameStore {
  currentLevel: number;
  playerProgress: Progress;
  inventory: Item[];
  achievements: Achievement[];
  // Actions
  completeLevel: () => void;
  saveProgress: () => void;
  unlockAchievement: (id: string) => void;
}
```

#### 4. 数据持久化
- **本地进度**：IndexedDB 保存游戏进度
- **云端同步**：Supabase 存储用户作品和成就
- **作品分享**：Canvas toDataURL 导出图片

#### 5. 性能优化
- Web Worker 处理复杂染色计算
- Canvas 离屏渲染优化
- 图案资源懒加载
- 关卡数据按需加载

---

## 📊 游戏数据结构

### 关卡配置
```typescript
interface Level {
  id: number;
  name: string;
  difficulty: 'easy' | 'medium' | 'hard';
  targetPattern: Pattern;        // 目标图案
  allowedTools: Tool[];          // 可用工具
  fabricType: FabricType;        // 布料类型
  timeLimit?: number;            // 时间限制（可选）
  hints: string[];               // 提示信息
  rewards: {
    coins: number;
    items?: Item[];
    achievement?: string;
  };
  starConditions: {             // 三星条件
    oneStar: Condition;
    twoStar: Condition;
    threeStar: Condition;
  };
}
```

### 图案数据
```typescript
interface Pattern {
  id: string;
  name: string;
  category: 'traditional' | 'modern' | 'custom';
  thumbnail: string;
  difficulty: number;           // 1-5
  instructions: string[];       // 制作步骤
  metadata: {
    origin: string;            // 来源地区
    history: string;           // 历史背景
    culturalMeaning: string;   // 文化寓意
  };
}
```

---

## 🎓 教育价值整合

### 与现有课程体系结合
- 完成游戏关卡解锁对应视频教程
- 游戏内嵌入工艺知识卡片
- 虚拟作品可生成为实体产品定制链接

### 知识点融入
每个关卡完成后展示：
- 该图案的文化历史
- 染料植物科普
- 化学原理简介（氧化还原）
- 大师作品欣赏

### 从游戏到实践的转化
- "复现挑战"：根据游戏作品购买同款材料包
- 线下工坊预约：完成高级关卡后推荐线下体验
- 社区分享：上传实际作品与游戏作品对比

---

## 📈 商业化与推广

### 盈利模式（可选）
- **基础版免费**：前10关免费
- **高级关卡**：解锁需蓝染币或观看广告
- **特殊布料/工具**：内购或完成挑战获取
- **作品定制**：游戏设计导出为真实产品订单

### 营销点
- **教育机构合作**：作为传统文化教学工具
- **抖音/小红书推广**：分享游戏作品引流
- **挑战赛活动**：定期举办创意设计大赛
- **IP 联动**：与博物馆合作推出珍品复刻关卡

---

## 🚀 开发路线图

### Phase 1：核心原型（2-3周）
- [ ] 基础 Canvas 交互框架
- [ ] 简单扎染算法实现
- [ ] 3个入门关卡设计
- [ ] 基础 UI/UX 搭建

### Phase 2：功能完善（3-4周）
- [ ] 完整染色模拟算法
- [ ] 15个核心关卡
- [ ] 成就系统
- [ ] 进度保存与云同步

### Phase 3：内容扩展（2-3周）
- [ ] 蜡染、夹染玩法
- [ ] 高级关卡（大师级）
- [ ] 社交功能（排行榜、分享）
- [ ] 作品展厅

### Phase 4：优化与推广（持续）
- [ ] 性能优化
- [ ] 音效音乐制作
- [ ] 多语言支持
- [ ] 移动端适配优化

---

## 🎯 成功指标

### 用户参与度
- 平均游戏时长 > 15分钟/次
- 关卡完成率 > 60%
- 7日留存率 > 40%

### 教育效果
- 90%玩家表示增加了对蓝染的了解
- 30%玩家继续观看相关课程
- 15%玩家购买实体材料包或产品

### 商业价值
- 为课程导流转化率 > 10%
- 为商城导流转化率 > 5%
- 用户分享率 > 20%

---

## 💡 创新点总结

1. **真实工艺还原**：不是简单的涂色游戏，而是完整模拟真实工艺流程
2. **寓教于乐**：每个操作都对应真实的化学/物理原理
3. **文化传承**：融入丰富的历史文化知识
4. **从虚拟到现实**：打通游戏与实体产品的转化路径
5. **社区驱动**：用户创作内容可成为新关卡
6. **科技与传统结合**：用现代技术让古老工艺焕发新生

---

## 🤔 潜在挑战与解决方案

### 挑战1：染色效果的真实模拟
**解决方案：**
- 与蓝染大师合作，录制真实工艺视频作为参考
- 收集大量真实作品照片训练算法
- 采用基于物理的渲染（PBR）技术

### 挑战2：移动端性能
**解决方案：**
- 采用 OffscreenCanvas 多线程渲染
- 实现 LOD（细节层次）系统
- 提供低配模式（简化特效）

### 挑战3：用户学习曲线
**解决方案：**
- 详细的新手引导（可跳过）
- 分步提示系统
- 视频教程嵌入
- 撤销/重做功能降低试错成本

---

**文档版本：** v1.0  
**创建日期：** 2025-11-22  
**作者：** Cascade AI  
**项目代号：** Indigo Moments
