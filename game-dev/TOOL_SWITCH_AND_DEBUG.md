# 🛠️ 工具切换 + 坐标调试指南

## ✅ 已实现的功能

### 1. 工具切换系统

**两种工具模式**：
- 🔵 **选择工具** - 拖动和调整图案
- 🟢 **添加工具** - 点击画布添加新图案

### 2. 自动模式切换

- 当你从下方选择图案时，自动切换到"添加工具"
- 手动切换后保持当前工具

### 3. 坐标调试输出

- 点击画布时输出详细坐标信息到控制台
- 帮助定位位置偏移问题

---

## 🎨 如何使用

### 步骤1: 刷新页面
```bash
Ctrl + Shift + R  # 强制刷新
```

### 步骤2: 查看工具栏

画布左侧有两个按钮：
```
┌─────────┐
│  🎯     │  ← 选择工具（蓝色=激活）
│  选择   │
└─────────┘

┌─────────┐
│  ➕     │  ← 添加工具（绿色=激活）
│  添加   │
└─────────┘
```

### 步骤3: 使用添加工具

```
1. 点击"添加工具"按钮（或选择一个图案）
2. 鼠标变成十字准星 ✚
3. 点击画布，图案出现在点击位置
4. 重复点击可添加多个图案
```

### 步骤4: 使用选择工具

```
1. 点击"选择工具"按钮
2. 鼠标变成普通箭头
3. 点击图案可选中
4. 拖动图案可移动
5. 点击空白处取消选中
```

---

## 🐛 调试位置偏移

### 打开控制台

按 **F12** 打开开发者工具，切换到 **Console** 标签

### 进行测试

**测试1: 点击画布左上角**
```
1. 切换到"添加工具"
2. 选择一个图案
3. 点击画布左上角（紧贴边框内侧）
4. 查看控制台输出
```

**控制台应该显示类似**：
```javascript
🎯 点击坐标: {
  鼠标屏幕坐标: "(XXX, YYY)",
  画布位置: "(XXX, YYY)",
  边框: "(4, 4)",
  内容区域尺寸: "592x592",
  相对位置像素: "(0.0, 0.0)",  // ← 应该接近 (0, 0)
  百分比: "(0.0%, 0.0%)"       // ← 应该接近 (0%, 0%)
}
```

**测试2: 点击画布中心**
```
1. 点击画布正中心
2. 查看控制台输出
```

**应该显示**：
```javascript
相对位置像素: "(296.0, 296.0)",  // 592 / 2 = 296
百分比: "(50.0%, 50.0%)"
```

### 判断问题

**如果百分比不对**：
- 点击左上角，百分比应该是 (0%, 0%)
- 点击中心，百分比应该是 (50%, 50%)
- 点击右下角，百分比应该是 (100%, 100%)

**如果偏移**：
```
实际情况: 点击 (0, 0) → 百分比 (X%, Y%)
期望情况: 点击 (0, 0) → 百分比 (0%, 0%)
偏移量: (X%, Y%)
```

**请告诉我**：
1. 点击位置（如：左上角）
2. 控制台显示的百分比
3. 图案实际出现的位置
4. 截图控制台输出

---

## 🎯 预期行为

### 添加模式
```
✅ 点击画布 → 添加图案
✅ 点击图案 → 选中图案（不添加新图案）
✅ 拖动图案 → 移动图案（不添加新图案）
✅ 鼠标显示十字准星
```

### 选择模式
```
✅ 点击画布 → 取消选中
✅ 点击图案 → 选中图案
✅ 拖动图案 → 移动图案
✅ 鼠标显示普通箭头
```

---

## 💡 使用技巧

### 快速切换

**添加多个图案**：
```
1. 选择图案 → 自动切换到添加模式
2. 连续点击画布多次
3. 添加完成后点击"选择工具"
```

**调整图案**：
```
1. 点击"选择工具"
2. 点击并拖动图案调整位置
3. 点击图案显示属性面板
4. 调整缩放、旋转等
```

### 避免误操作

**问题**：拖动图案时意外添加新图案

**解决**：
- ✅ 现在不会了！
- 只有在"添加模式"且点击空白处才会添加
- 拖动图案不会添加新图案

---

## 🔍 位置问题排查

### 如果图案位置还是不对

**请做以下测试**：

1. **打开控制台（F12）**

2. **点击画布四个角**
   ```
   左上角 → 应该显示 (0%, 0%)
   右上角 → 应该显示 (100%, 0%)
   左下角 → 应该显示 (0%, 100%)
   右下角 → 应该显示 (100%, 100%)
   ```

3. **截图控制台输出**

4. **告诉我**：
   - 哪个角的百分比不对
   - 图案实际出现在哪里
   - 偏移了多少

### 检查列表

- [ ] 是否刷新了页面？（Ctrl + Shift + R）
- [ ] 是否清除了缓存？
- [ ] 是否在"添加模式"？
- [ ] 是否选择了图案？
- [ ] 控制台是否有错误？
- [ ] 百分比计算是否正确？

---

## 📊 坐标计算公式

### 当前实现

```typescript
// 1. 获取画布信息
const rect = canvas.getBoundingClientRect()
const borderLeft = canvas.clientLeft || 0  // 边框宽度
const borderTop = canvas.clientTop || 0

// 2. 计算鼠标相对位置（像素）
const mouseX = e.clientX - rect.left - borderLeft
const mouseY = e.clientY - rect.top - borderTop

// 3. 获取内容区域尺寸
const contentWidth = canvas.clientWidth   // 不含边框
const contentHeight = canvas.clientHeight

// 4. 计算百分比
const x = (mouseX / contentWidth) * 100
const y = (mouseY / contentHeight) * 100
```

### 为什么这样计算

```
画布总尺寸: 600x600
边框: 4px (左右各4px，上下各4px)
内容区域: 592x592

点击左上角内侧:
- e.clientX = rect.left + 4
- mouseX = (rect.left + 4) - rect.left - 4 = 0 ✅
- x = 0 / 592 * 100 = 0% ✅
```

---

## 🚀 立即测试

1. **刷新页面**
2. **打开控制台（F12）**
3. **切换到添加模式**
4. **选择一个图案**
5. **点击画布四个角**
6. **查看控制台输出**
7. **报告结果**

---

**期待你的测试反馈！** 🎯✨
